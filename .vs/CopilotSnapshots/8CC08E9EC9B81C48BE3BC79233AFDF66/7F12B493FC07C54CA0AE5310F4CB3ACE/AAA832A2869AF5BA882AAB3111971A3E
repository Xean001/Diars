@model RunaTalento.Models.Medalla

@{
    ViewData["Title"] = "Detalles de Medalla";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="admin-header">
    <div class="admin-header-content">
        <div>
            <h1 class="admin-title">
                <i class="bi bi-award-fill"></i>
                Detalles de Medalla
            </h1>
            <p class="admin-subtitle">Información completa de la medalla: <strong>@Model.Nombre</strong></p>
        </div>
        <div class="d-flex gap-2">
            <a asp-action="Edit" asp-route-id="@Model.IdMedalla" class="btn-warning-admin">
                <i class="bi bi-pencil-fill"></i> Editar
            </a>
            <a asp-action="Index" class="btn-secondary-admin">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>
</div>

<div class="row">
    <!-- Card principal de la medalla -->
    <div class="col-md-5 mb-4">
        <div class="admin-content text-center">
            <!-- Imagen de la medalla -->
            <div class="mb-4">
                @if (!string.IsNullOrEmpty(Model.ImagenUrl))
                {
                    <img src="@Model.ImagenUrl" 
                         alt="@Model.Nombre" 
                         class="img-fluid" 
                         style="max-height: 300px; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.12);" />
                }
                else
                {
                    <div style="display: inline-flex; align-items: center; justify-content: center; width: 250px; height: 250px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 50%; box-shadow: 0 8px 24px rgba(0,0,0,0.12);">
                        <i class="bi bi-award-fill" style="font-size: 8rem; color: #f59e0b;"></i>
                    </div>
                }
            </div>

            <!-- Nombre de la medalla -->
            <h3 class="fw-bold mb-2" style="color: #0f172a;">@Model.Nombre</h3>
            
            <!-- Descripción -->
            @if (!string.IsNullOrEmpty(Model.Descripcion))
            {
                <p class="text-muted mb-0" style="font-size: 0.95rem; line-height: 1.6;">
                    @Model.Descripcion
                </p>
            }
            else
            {
                <p class="text-muted fst-italic mb-0">Sin descripción</p>
            }
        </div>
    </div>

    <!-- Información detallada -->
    <div class="col-md-7">
        <!-- Datos de la medalla -->
        <div class="detail-card mb-4">
            <h4 class="detail-card-title">
                <i class="bi bi-info-circle-fill"></i>
                Información de la Medalla
            </h4>
            <div class="detail-card-body">
                <div class="detail-item">
                    <span class="detail-label">
                        <i class="bi bi-award me-2"></i>
                        Nombre:
                    </span>
                    <span class="detail-value fw-bold">@Model.Nombre</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">
                        <i class="bi bi-text-paragraph me-2"></i>
                        Descripción:
                    </span>
                    <span class="detail-value">@(Model.Descripcion ?? "No especificada")</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">
                        <i class="bi bi-image me-2"></i>
                        URL de Imagen:
                    </span>
                    <span class="detail-value">
                        @if (!string.IsNullOrEmpty(Model.ImagenUrl))
                        {
                            <code style="font-size: 0.875rem; background: #f1f5f9; padding: 4px 8px; border-radius: 4px;">@Model.ImagenUrl</code>
                        }
                        else
                        {
                            <span class="text-muted">No configurada (se usa icono predeterminado)</span>
                        }
                    </span>
                </div>
            </div>
        </div>

        <!-- Estudiantes que tienen esta medalla -->
        <div class="detail-card">
            <h4 class="detail-card-title">
                <i class="bi bi-people-fill"></i>
                Estudiantes con esta Medalla
            </h4>
            <div class="detail-card-body">
                @if (Model.MedallasEstudiantes != null && Model.MedallasEstudiantes.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Estudiante</th>
                                    <th>Fecha de Otorgamiento</th>
                                    <th>Otorgada por</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var medallaEst in Model.MedallasEstudiantes)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="table-avatar bg-blue me-2">
                                                    @(medallaEst.Estudiante?.Nombres?.Substring(0, 1) ?? "?")@(medallaEst.Estudiante?.Apellidos?.Substring(0, 1) ?? "")
                                                </div>
                                                <div>
                                                    <strong>@medallaEst.Estudiante?.Nombres @medallaEst.Estudiante?.Apellidos</strong>
                                                    <br />
                                                    <small class="text-muted">@medallaEst.Estudiante?.Email</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <i class="bi bi-calendar3 me-1"></i>
                                            @medallaEst.FechaOtorgada.ToString("dd/MM/yyyy")
                                            <br />
                                            <small class="text-muted">
                                                <i class="bi bi-clock me-1"></i>
                                                @medallaEst.FechaOtorgada.ToString("HH:mm")
                                            </small>
                                        </td>
                                        <td>
                                            @if (medallaEst.Docente != null)
                                            {
                                                <span class="badge badge-docente">
                                                    <i class="bi bi-person-badge"></i>
                                                    @medallaEst.Docente.Nombres @medallaEst.Docente.Apellidos
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">Sistema</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3 p-3" style="background: #f8fafc; border-radius: 8px;">
                        <small class="text-muted">
                            <i class="bi bi-award-fill me-1"></i>
                            <strong>Total de otorgamientos:</strong> @Model.MedallasEstudiantes.Count
                        </small>
                    </div>
                }
                else
                {
                    <div class="empty-state py-4">
                        <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                        <p class="mb-0 mt-2 text-muted">Esta medalla aún no ha sido otorgada a ningún estudiante</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Acciones finales -->
<div class="admin-content mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <a asp-action="Index" class="btn-secondary-admin">
            <i class="bi bi-arrow-left"></i>
            Volver al listado
        </a>
        <div class="d-flex gap-2">
            <a asp-action="Edit" asp-route-id="@Model.IdMedalla" class="btn-warning-admin">
                <i class="bi bi-pencil-fill"></i> Editar Medalla
            </a>
            <a asp-action="Delete" asp-route-id="@Model.IdMedalla" class="btn-danger-admin">
                <i class="bi bi-trash-fill"></i> Eliminar Medalla
            </a>
        </div>
    </div>
</div>
